#!/bin/bash

# Debug! Host target, so you can't use the `source` solution, you have to copy the _debug.sh file content directly.
# << webtown-workflow-package/opt/webtown-workflow/lib/_debug.sh !!!
if [ ${DEBUG:-0} -ge 1 ]; then
    [[ -f /.dockerenv ]] && echo -e "\033[1mDocker: \033[33m${WF_DOCKER_HOST_CHAIN}\033[0m"
    echo -e "\033[1mDEBUG\033[33m $(realpath "$0")\033[0m"
    SYMFONY_COMMAND_DEBUG="-vvv"
    DOCKER_DEBUG="-e DEBUG=${DEBUG}"
fi
[[ ${DEBUG:-0} -ge 2 ]] && set -x

case $1 in
    --enter)
        ${WEBTOWN_WORKFLOW_BASE_PATH:-~/.webtown-workflow}/bin/workflow_runner.sh /bin/bash
    ;;
    -u|--update)
        git archive --remote=git@gitlab.webtown.hu:webtown/webtown-workflow.git ${2:-HEAD} install-wf.sh | tar xO | bash
#        echo -e "\033[32mStarting upgrade from: \033[33m${WF_PROGRAM_REPOSITORY}\033[0m"
#        echo -e "\033[32mPackage:               \033[33m${PACKAGE_NAME}\033[0m"
#        cd /tmp && git archive --remote=${WF_PROGRAM_REPOSITORY} HEAD ${PACKAGE_NAME} | tar -x || quit
#        sudo dpkg -i ${PACKAGE_NAME} || quit
#        rm -rf ${PACKAGE_NAME}
    ;;
    *)
        ${WEBTOWN_WORKFLOW_BASE_PATH:-~/.webtown-workflow}/bin/workflow_runner.sh wf ${@}
    ;;
esac
